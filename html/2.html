<!DOCTYPE html>

<html lang="en">
  <head>
    <link href="/css/video.scss" rel="stylesheet"/>
    <script src="/lib/jquery-1.9.1.min.js"></script>
    <script src="/lib/jwplayer/jwplayer.js"></script>
    <!--script type="text/javascript" src="//use.typekit.net/qgw0qkt.js"></script-->
    <!--script type="text/javascript">try{Typekit.load();}catch(e){}</script--> 
    <script>
        $(function() {
            /*
            jwplayer("main-video").setup({
                file: "https://dl.dropboxusercontent.com/sh/qyccksbgboagmwh/kw8lFWMkfQ/cs50_week2m_camA-360p.mp4",
                width: "100%",
                aspectratio: "16:9"
            });
            
            jwplayer("one").setup({
                file: "https://dl.dropboxusercontent.com/sh/qyccksbgboagmwh/ttB0Ro2j-p/cs50_week2m_camB-360p.mp4",
                width: "100%",
                aspectratio: "16:9"
            });
            */

            var move = false;
            $("#dragger").mousedown(function(e) {
                move = true;
            })
            
            $(document).mouseup(function(e) {
                move = false;
            });

            var reverseResize = function(desired, angle, z) {
                var a = angle / 360.0 * Math.PI;
                var ret = (z * desired)/(z * Math.cos(a) - desired * Math.sin(a));
                return ret;
            }
           
            var resizeVideos = function(pageX) {
                var ratio = pageX/$(window).width();
                if (ratio < .5)
                    return;
                
                $('#left').css('width', pageX);
                $('#right').css('left', pageX + 1);
                $('#dragger').css('left', pageX + 1);
                
                // var degreeLeft = ratio >= .5 ? 2 : 2 + 20 * (.5 - ratio);
                // var degreeRight = ratio <= .5 ? -2 : -2 + (.5 - ratio) * 20;
                var degreeRight = ratio <= .6 ? 0 : (.6 - ratio) * 45;
                // var dlStr = "rotateY(" + degreeLeft + "deg)";
                var drStr = "rotateY(" + degreeRight + "deg)";

                /*
                $('#main-video-wrapper > video').css({
                    "-webkit-transform": dlStr,
                    "-moz-transform": dlStr,
                    "-ms-transform": dlStr,
                    "-o-transform": dlStr,
                    "transform": dlStr,
                });
                */

                $('#ancilliary-videos > video').css({
                    "-webkit-transform": drStr,
                    "-moz-transform": drStr,
                    "-ms-transform": drStr,
                    "-o-transform": drStr,
                    "transform": drStr,
                });

                // var mvWidth = reverseResize($('#main-video-wrapper').width(), degreeLeft, 200);
                var mvWidth = $('#main-video-wrapper').width();
                var mvHeight = mvWidth * 9.0/16.0;
                var ovWidth = reverseResize($('#ancilliary-videos').width(), -degreeRight, 200);
                var ovHeight = ovWidth * 9.0/16.0;
                $("#main-video-wrapper > video").css({
                    width: mvWidth,
                    height: mvHeight
                });
                $("#ancilliary-videos > video").css({
                    width: ovWidth,
                    height: ovHeight
                });
                $('#main-video-wrapper').css('margin-top', -$('#main-video-wrapper').height()/2);
                $('#ancilliary-videos').css('margin-top', -$('#ancilliary-videos').height()/2);
            }
 
            var currPageX = 900;
            $(document).mousemove(function(e) {
                if (move) {
                    currPageX = e.pageX;
                    
                    resizeVideos(e.pageX);
                }
            });
                    
            $('#ancilliary-videos').on('click', 'video', function() {
                $('#main-video-wrapper video').insertAfter($(this));
                $(this).appendTo("#main-video-wrapper");
                resizeVideos(currPageX);
                $('video').each(function(i, e) {
                    e.play();
                });
            });
           
            $(window).resize(function() {
                resizeVideos(currPageX);
            });

            resizeVideos(currPageX);
        });
    </script>
    <title>Hello World!</title>
  </head>
  <body>
    <div id="left">
      <div id="main-video-wrapper">
        <video autoplay src="https://dl.dropboxusercontent.com/sh/qyccksbgboagmwh/kw8lFWMkfQ/cs50_week2m_camA-360p.mp4">
        </video>
      </div>
    </div>
    <div id="dragger"> 
    </div>
    <div id="right">
      <div id="ancilliary-videos">
        <video autoplay src="https://dl.dropboxusercontent.com/sh/qyccksbgboagmwh/ttB0Ro2j-p/cs50_week2m_camB-360p.mp4">
        </video>
      </div>
    </div>
    <div id="control-bar">
      <div id="left-controls">
        <div id="play-pause-control"></div><div id="skip-control">
        </div>
      </div>
      <div id="time">
        <div id="timecode">00:55</div>
        <div id="progress"></div>
        <div id="timeline"></div>
        <div id="timelength">13:37</div>
      </div>
      <div id="right-controls">
        <div id="download-control"></div><div id="captions-control">
        </div><div id="quality-control">
            HD
        </div><div id="fullscreen-control">
        </div>
      </div>
    </div>
  </body>
</html>
