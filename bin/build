#!/bin/sh

# http://stackoverflow.com/a/4774063
pushd `dirname $0` > /dev/null
SCRIPTPATH=`pwd`
popd > /dev/null

# remove public/build
rm -rf "$SCRIPTPATH"/../public/build
mkdir -p "$SCRIPTPATH"/../public/build/{css,img,js}

# combine JavaScript files into one file
echo "Building JavaScript..."
cat \
    "$SCRIPTPATH"/../lib/underscore-min.js \
    "$SCRIPTPATH"/../lib/jwplayer/jwplayer.js \
    "$SCRIPTPATH"/../lib/cs50.analytics.js \
    "$SCRIPTPATH"/../src/js/video50.js \
    "$SCRIPTPATH"/../src/js/video50.languages.js \
    > "$SCRIPTPATH"/../public/build/js/video50.min.js

# compress JavaScript 
java -jar "$SCRIPTPATH"/../lib/yuicompressor-2.4.7.jar -o "$SCRIPTPATH"/../public/build/js/video50.min.js "$SCRIPTPATH"/../public/build/js/video50.min.js

# generate CSS from SCSS
echo "Building CSS..."
sass "$SCRIPTPATH"/../src/css/video50.scss > "$SCRIPTPATH"/../public/build/css/video50.min.css

# compress CSS
java -jar "$SCRIPTPATH"/../lib/yuicompressor-2.4.7.jar -o "$SCRIPTPATH"/../public/build/css/video50.min.css "$SCRIPTPATH"/../public/build/css/video50.min.css

# copy assets
echo "Copying assets..."
cp "$SCRIPTPATH"/../lib/jquery-1.9.1.min.js "$SCRIPTPATH"/../public/build/js/
cp "$SCRIPTPATH"/../lib/jwplayer/jwplayer.flash.swf "$SCRIPTPATH"/../public/build/js/
cp "$SCRIPTPATH"/../src/img/* "$SCRIPTPATH"/../public/build/img/

# chmod
echo "Chmodding..."
"$SCRIPTPATH"/chmod
